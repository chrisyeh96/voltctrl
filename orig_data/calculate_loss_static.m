% Guannan Qu 03/28/2019
% This file is to calculate the real feeder loss for the static simulation
% setting. The static simulation results are in ./fig0325/static.mat
clear all;clc;close all;
load('./fig0325/static.mat');
loss = zeros(T,1);
for t=1:T
    tmp_case_mpc = case_mpc;
    tmp_case_mpc.bus(2:end,QD) =tmp_case_mpc.bus(2:end,QD) -q(:,t); % apply control action to case mpc
    pfresult = runpf(tmp_case_mpc);
    [tmp_loss,~] = get_losses(pfresult);
    loss(t) = sum(real(tmp_loss));
end
%%
figure;
    plot(1:T,loss,'LineWidth',1.5);hold on;
    %plot(1:T,opt_val*ones(1,T),'--','LineWidth',1.5);
    xlabel('Iterations');
    ylabel('Line Loss');
    set(gca,'FontSize',font_size);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       